{"ast":null,"code":"import React,{useState}from'react';import{useNavigate}from'react-router-dom';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CreatePost=_ref=>{let{user}=_ref;const navigate=useNavigate();const[formData,setFormData]=useState({shop_name:'',description:'',address:'',latitude:'',longitude:''});const[image,setImage]=useState(null);const[imagePreview,setImagePreview]=useState(null);const[loading,setLoading]=useState(false);const[error,setError]=useState('');const handleChange=e=>{setFormData({...formData,[e.target.name]:e.target.value});};const handleImageChange=e=>{const file=e.target.files[0];if(file){setImage(file);const reader=new FileReader();reader.onloadend=()=>{setImagePreview(reader.result);};reader.readAsDataURL(file);}};const getCurrentLocation=()=>{if(navigator.geolocation){navigator.geolocation.getCurrentPosition(position=>{setFormData({...formData,latitude:position.coords.latitude.toString(),longitude:position.coords.longitude.toString()});},error=>{console.error('Error getting location:',error);alert('ไม่สามารถรับตำแหน่งปัจจุบันได้');});}else{alert('เบราว์เซอร์ไม่รองรับ GPS');}};const handleSubmit=async e=>{e.preventDefault();setError('');setLoading(true);try{const token=localStorage.getItem('token');const formDataToSend=new FormData();Object.keys(formData).forEach(key=>{formDataToSend.append(key,formData[key]);});if(image){formDataToSend.append('image',image);}const response=await axios.post('http://localhost:5000/api/posts',formDataToSend,{headers:{Authorization:`Bearer ${token}`,'Content-Type':'multipart/form-data'}});if(response.data.postId){navigate('/');}}catch(error){var _error$response,_error$response$data;setError(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||'เกิดข้อผิดพลาดในการสร้างโพสต์');}finally{setLoading(false);}};return/*#__PURE__*/_jsx(\"div\",{className:\"create-post-container\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"create-post-card\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u0E41\\u0E1A\\u0E48\\u0E07\\u0E1B\\u0E31\\u0E19\\u0E23\\u0E49\\u0E32\\u0E19\\u0E04\\u0E49\\u0E32\\u0E14\\u0E35\\u0E46\"}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"shop_name\",children:\"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E23\\u0E49\\u0E32\\u0E19:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"shop_name\",name:\"shop_name\",value:formData.shop_name,onChange:handleChange,required:true,placeholder:\"\\u0E0A\\u0E37\\u0E48\\u0E2D\\u0E23\\u0E49\\u0E32\\u0E19\\u0E04\\u0E49\\u0E32\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"description\",children:\"\\u0E23\\u0E32\\u0E22\\u0E25\\u0E30\\u0E40\\u0E2D\\u0E35\\u0E22\\u0E14:\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"description\",name:\"description\",value:formData.description,onChange:handleChange,required:true,rows:\"4\",placeholder:\"\\u0E40\\u0E25\\u0E48\\u0E32\\u0E16\\u0E36\\u0E07\\u0E23\\u0E49\\u0E32\\u0E19\\u0E19\\u0E35\\u0E49\\u0E27\\u0E48\\u0E32\\u0E40\\u0E1B\\u0E47\\u0E19\\u0E22\\u0E31\\u0E07\\u0E44\\u0E07 \\u0E2D\\u0E32\\u0E2B\\u0E32\\u0E23\\u0E2D\\u0E23\\u0E48\\u0E2D\\u0E22\\u0E44\\u0E2B\\u0E21 \\u0E1A\\u0E23\\u0E23\\u0E22\\u0E32\\u0E01\\u0E32\\u0E28\\u0E40\\u0E1B\\u0E47\\u0E19\\u0E2D\\u0E22\\u0E48\\u0E32\\u0E07\\u0E44\\u0E23...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"address\",children:\"\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"address\",name:\"address\",value:formData.address,onChange:handleChange,placeholder:\"\\u0E17\\u0E35\\u0E48\\u0E2D\\u0E22\\u0E39\\u0E48\\u0E23\\u0E49\\u0E32\\u0E19\\u0E04\\u0E49\\u0E32\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"image\",children:\"\\u0E23\\u0E39\\u0E1B\\u0E20\\u0E32\\u0E1E:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"image\",accept:\"image/*\",onChange:handleImageChange}),imagePreview&&/*#__PURE__*/_jsx(\"div\",{className:\"image-preview\",children:/*#__PURE__*/_jsx(\"img\",{src:imagePreview,alt:\"Preview\"})})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>navigate('/'),className:\"cancel-btn\",children:\"\\u0E22\\u0E01\\u0E40\\u0E25\\u0E34\\u0E01\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"submit-btn\",children:loading?'กำลังสร้างโพสต์...':'แบ่งปันร้านค้า'})]})]})]})});};export default CreatePost;","map":{"version":3,"names":["React","useState","useNavigate","axios","jsx","_jsx","jsxs","_jsxs","CreatePost","_ref","user","navigate","formData","setFormData","shop_name","description","address","latitude","longitude","image","setImage","imagePreview","setImagePreview","loading","setLoading","error","setError","handleChange","e","target","name","value","handleImageChange","file","files","reader","FileReader","onloadend","result","readAsDataURL","getCurrentLocation","navigator","geolocation","getCurrentPosition","position","coords","toString","console","alert","handleSubmit","preventDefault","token","localStorage","getItem","formDataToSend","FormData","Object","keys","forEach","key","append","response","post","headers","Authorization","data","postId","_error$response","_error$response$data","className","children","onSubmit","htmlFor","type","id","onChange","required","placeholder","rows","accept","src","alt","onClick","disabled"],"sources":["C:/Users/Astaroth/OneDrive/เอกสาร/GitHub/thai-shop-review/client/src/components/CreatePost.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\n\r\nconst CreatePost = ({ user }) => {\r\n  const navigate = useNavigate();\r\n  const [formData, setFormData] = useState({\r\n    shop_name: '',\r\n    description: '',\r\n    address: '',\r\n    latitude: '',\r\n    longitude: ''\r\n  });\r\n  const [image, setImage] = useState(null);\r\n  const [imagePreview, setImagePreview] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleChange = (e) => {\r\n    setFormData({\r\n      ...formData,\r\n      [e.target.name]: e.target.value\r\n    });\r\n  };\r\n\r\n  const handleImageChange = (e) => {\r\n    const file = e.target.files[0];\r\n    if (file) {\r\n      setImage(file);\r\n      const reader = new FileReader();\r\n      reader.onloadend = () => {\r\n        setImagePreview(reader.result);\r\n      };\r\n      reader.readAsDataURL(file);\r\n    }\r\n  };\r\n\r\n  const getCurrentLocation = () => {\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          setFormData({\r\n            ...formData,\r\n            latitude: position.coords.latitude.toString(),\r\n            longitude: position.coords.longitude.toString()\r\n          });\r\n        },\r\n        (error) => {\r\n          console.error('Error getting location:', error);\r\n          alert('ไม่สามารถรับตำแหน่งปัจจุบันได้');\r\n        }\r\n      );\r\n    } else {\r\n      alert('เบราว์เซอร์ไม่รองรับ GPS');\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      const formDataToSend = new FormData();\r\n      \r\n      Object.keys(formData).forEach(key => {\r\n        formDataToSend.append(key, formData[key]);\r\n      });\r\n      \r\n      if (image) {\r\n        formDataToSend.append('image', image);\r\n      }\r\n\r\n      const response = await axios.post(\r\n        'http://localhost:5000/api/posts',\r\n        formDataToSend,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n            'Content-Type': 'multipart/form-data'\r\n          }\r\n        }\r\n      );\r\n\r\n      if (response.data.postId) {\r\n        navigate('/');\r\n      }\r\n    } catch (error) {\r\n      setError(error.response?.data?.error || 'เกิดข้อผิดพลาดในการสร้างโพสต์');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"create-post-container\">\r\n      <div className=\"create-post-card\">\r\n        <h2>แบ่งปันร้านค้าดีๆ</h2>\r\n        \r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"shop_name\">ชื่อร้าน:</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"shop_name\"\r\n              name=\"shop_name\"\r\n              value={formData.shop_name}\r\n              onChange={handleChange}\r\n              required\r\n              placeholder=\"ชื่อร้านค้า\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"description\">รายละเอียด:</label>\r\n            <textarea\r\n              id=\"description\"\r\n              name=\"description\"\r\n              value={formData.description}\r\n              onChange={handleChange}\r\n              required\r\n              rows=\"4\"\r\n              placeholder=\"เล่าถึงร้านนี้ว่าเป็นยังไง อาหารอร่อยไหม บรรยากาศเป็นอย่างไร...\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"address\">ที่อยู่:</label>\r\n            <input\r\n              type=\"text\"\r\n              id=\"address\"\r\n              name=\"address\"\r\n              value={formData.address}\r\n              onChange={handleChange}\r\n              placeholder=\"ที่อยู่ร้านค้า\"\r\n            />\r\n          </div>\r\n\r\n          <div className=\"form-group\">\r\n            <label htmlFor=\"image\">รูปภาพ:</label>\r\n            <input\r\n              type=\"file\"\r\n              id=\"image\"\r\n              accept=\"image/*\"\r\n              onChange={handleImageChange}\r\n            />\r\n            \r\n            {imagePreview && (\r\n              <div className=\"image-preview\">\r\n                <img src={imagePreview} alt=\"Preview\" />\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          {error && <div className=\"error-message\">{error}</div>}\r\n\r\n          <div className=\"form-actions\">\r\n            <button \r\n              type=\"button\" \r\n              onClick={() => navigate('/')}\r\n              className=\"cancel-btn\"\r\n            >\r\n              ยกเลิก\r\n            </button>\r\n            \r\n            <button \r\n              type=\"submit\" \r\n              disabled={loading}\r\n              className=\"submit-btn\"\r\n            >\r\n              {loading ? 'กำลังสร้างโพสต์...' : 'แบ่งปันร้านค้า'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CreatePost;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}